---
title: "Homework 2"
author: "Wenxin Tian"
date: "`r Sys.Date()`"
output: github_document
---

```{r, message=FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

Importing and cleaning pol-months.csv dataset:

```{r}
month_names = c("Jan","Feb","Mar",
                "Apr","May","Jun",
                "Jul","Aug","Sep",
                "Oct","Nov","Dec")

pols_df = 
  read_csv("data/pols-month.csv") |>
  janitor::clean_names() |>
  separate(mon, into = c('year', 'month', 'day'), '-') |>  # separate into year, month, and day
  mutate(year = as.numeric(year)) |>
  mutate(month = as.numeric(month)) |> 
  mutate(month = month_names[month]) |>                    # changing month num to month name
  mutate(                                                  # adding president variable
    president = case_match(
      prez_gop,
      1 ~ 'gop',
      0 ~ 'dem'
    )) |> 
  relocate(president, .after = month) |>                   # relocating president variable  
  select(-c(prez_dem, prez_gop, day))                      # removing prez_dem, prez_gop, and day variables

pols_df
```

Importing and cleaning snp.csv dataset:

```{r}
snp_df = 
  read_csv("data/snp.csv") |>
  janitor::clean_names() |>
  separate(date, into = c('month', 'day', 'year'), '/') |>
  mutate(
    month = as.numeric(month),
    month = month_names[month],
    year = as.numeric(year) + 2000
  ) |>
  select(-day) |>
  arrange(year, month) |>
  relocate(month) |>
  relocate(year)

snp_df
```

Importing and cleaning unemployment.csv:

```{r}
unemployment_df =
  read_csv("data/unemployment.csv") |>
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) |>
  janitor::clean_names()

unemployment_df
```

Merging the 3 datasets together:

```{r}
result =
  left_join(pols_df, snp_df) |>
  left_join(unemployment_df)

result
```

## Problem 2

Importing and cleaning the Mr. Trash Wheel dataset:

```{r}
mrtrashwheel_df =
  read_excel(
    "data/trashwheel.xlsx",
    sheet = 1,
    range = "A2:N549") |>
  janitor::clean_names() |>
  mutate(year = as.numeric(year))
```

Calculating `homes_powered` variable based on note:

* Homes Powered - Each ton of trash equates to on average 500 kilowatts of electricity.  An average household will use 30 kilowatts per day.

```{r}
mrtrashwheel_df =
  mutate(
    mrtrashwheel_df,
    homes_powered = weight_tons * 500 / 30
  )

mrtrashwheel_df
```

Same process for Professor Trash Wheel and Gwynnda:

```{r}
professor_df =
  read_excel(
    "data/trashwheel.xlsx",
    sheet = 2,
    range = "A2:M96") |>
  janitor::clean_names() |>
  mutate(homes_powered = weight_tons * 500 / 30)

professor_df

gwynnda_df =
  read_excel(
    "data/trashwheel.xlsx",
    sheet = 4,
    range = "A2:K108") |>
  janitor::clean_names() |>
  mutate(homes_powered = weight_tons * 500 / 30)

gwynnda_df
```

Combining 3 datasets:

```{r}
mrtrashwheel_df =
  mutate(
    mrtrashwheel_df,
    trashwheel = "mr_trashwheel"
  ) |>
  relocate(trashwheel)

professor_df =
  mutate(
    professor_df,
    trashwheel = "professor_trashwheel"
  ) |>
  relocate(trashwheel)

gwynnda_df =
  mutate(
    gwynnda_df,
    trashwheel = "gwynnda"
  ) |>
  relocate(trashwheel)

trashwheels_df = 
  bind_rows(mrtrashwheel_df, professor_df, gwynnda_df)

trashwheels_df
```

### Dataset Description:

In total, Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda collected `r nrow(trashwheels_df)` dumpsters of trash, each contributing `r nrow(mrtrashwheel_df)`, `r nrow(professor_df)`, and `r nrow(gwynnda_df)` dumpsters, respectively. The dataset includes basic information of trash collected such as dumpster number, date, weight, and volume, as well as more detailed information regarding the composition of trash being collected like number of plastic bottles, cigarette butts, etc. Professor Trash Wheel collected a total of `r sum(pull(professor_df, weight_tons))` tons of trash. In July of 2021, Gwynnda collected a total of `r sum(pull(gwynnda_df, cigarette_butts)[1:5]) |> format(scientific = FALSE)` cigarette butts.

## Problem 3

Import baseline demographics dataset:

```{r}
baseline_df =
  read_csv("data/MCI_baseline.csv", skip = 1) |>
  janitor::clean_names() |>
  mutate(
    sex = case_match(
      sex,
      1 ~ "male",
      0 ~ "female"
    ),
    apoe4 = case_match(
      apoe4,
      1 ~ "carrier",
      0 ~ "non-carrier"
    )
  ) |>
  filter(current_age < age_at_onset | age_at_onset == ".")

baseline_df

developed_mci = nrow(filter(baseline_df, age_at_onset != "."))

mean_age = mean(pull(baseline_df, current_age))

female_count = nrow(filter(baseline_df, sex == "female"))

male_count = nrow(filter(baseline_df, sex == "male"))

female_carrier_proportion = 
  nrow(filter(baseline_df, sex == "female" & apoe4 == "carrier")) / female_count * 100

baseline_df
```

After importing the file, sex and carrier variables were converted from numeric to descriptive for clarity. 4 participants who developed MCI onset before the study were removed. Out of the remaining `r female_count + male_count` participants, `r female_count` were female, and `r male_count` were male. The average baseline age is `r mean_age`. In total, `r developed_mci` participants developed MCI during the followup period. Out of the `r female_count` female participants, `r female_carrier_proportion`% were APOE4 carriers.


